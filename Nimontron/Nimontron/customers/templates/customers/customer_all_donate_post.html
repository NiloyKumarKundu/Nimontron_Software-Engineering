{% include 'customers/customer_header.html' %} 
{% load static %}


<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

<link href="{% static 'customers/css/style.css' %}" rel="stylesheet">
<link href="{% static 'customers/css/bootstrap.min.css' %}" rel="stylesheet">


<!-- Sweet Alert -->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

<div class="container" id="app">
    <table class="table">
        <thead>
            <tr>
                <th scope="col">No.</th>
                <th scope="col">Item Name</th>
                <th scope="col">Preferable Area</th>
                <th scope="col">Quantity</th>
                <th scope="col">Contact</th>
                <th scope="col">Last Date of Donation</th>
                <th scope="col">Status</th>
                <th colspan="2" class="text-center"> <span style="margin-left: -55px;">Action</span> </th> 
            </tr>
        </thead>
        <tbody>
            <tr v-for="(i, count) in stories">
                <td>[[ (count + 1) ]] </td>
                <td>[[ i.title ]]</td>
                <td>[[ i.area ]]</td>
                <td>[[ i.quantity ]]</td>
                <td>[[ i.contact ]]</td>
                <td>[[ i.end_date | formatDate ]] </td>
                <td>[[ i.status ]]</td>
                <td>
                    <a href="#" data-target="#mymodel" @click="specificStories([[i.id]])" data-toggle="modal" class="btn btn-success btn-sm">Edit</a>
                </td>

                <td>
                    <a href="#" @click="deleteStories([[i.id]])"  class="btn btn-danger btn-sm delete">Delete</a>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="modal fade" id="mymodel">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Edit Info</h4>
                    <button class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <form action="#" v-for="(i, count) in post">
                        {% csrf_token %}
                        <div class="form-group">
                            <label>Item Name </label>
                            <input type="text" v-model="i.title" name="name" class="form-control" required>
                        </div>
                        <br>
                        <div class="form-group">
                            <label>Preferable Area</label>
                            <input type="text" name="area" v-model="i.area" class="form-control" required>
                        </div>
                        <br>
                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="text" name="quantity" v-model="i.quantity" class="form-control" required>
                        </div>
                        <br>
                        <div class="form-group">
                            <label>Contact</label>
                            <input type="text" name="contact" v-model="i.contact" class="form-control" required>
                        </div>
                        <br>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" name="end_date" v-model="i.end_date" class="form-control" required>
                        </div>
                    </form>
                </div>

                <div class="modal-footer justify-content-center">
                    <button class="btn btn-primary" data-dismiss="modal">Update</button>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'customers/customer_footer.html' %}


<script type="text/javascript">
    let app = new Vue({
        el: '#app',
        data: {
            stories: [],
            post: [],
        },
        delimiters: ['[[', ']]'],
        methods: {
            getStories: function() {
                fetch('http://127.0.0.1:8000/api/customer_donate_post')
                .then(ret => ret.json())
                .then(res => {
                    this.stories = (res);
                });
            },

            deleteStories: function(id) {
                fetch('http://127.0.0.1:8000/api/customer_delete_specific_donate_post/' + id)
                .then(ret => ret.json())
                .then(res => {
                    this.getStories();
                    console.log(id)
                });
            },

            editStories: function(id) {
                fetch('http://127.0.0.1:8000/api/customer_delete_specific_donate_post/' + id)
                .then(ret => ret.json())
                .then(res => {
                    this.getStories();
                });
            },
            specificStories: function(id) {
                post: [],
                fetch('http://127.0.0.1:8000/api/customer_specific_donate_post/' + id)
                .then(ret => ret.json())
                .then(res => {
                    this.post = res;
                    console.log(this.post);
                    this.getStories();
                });
            }
        },
        created: function() {
            this.getStories();
        },
    });

    Vue.filter('formatDate', function(value) {
        if (value) {
          return moment(String(value)).format('MMM DD, YYYY')
        }
    });

</script>


<script>
    $(".delete").click(function (e) {
        console.log("Pressed");
        var self = $(this);
        e.preventDefault();
        swal({
                title: "Are you sure?",
                text: "Once deleted, you will not be able to recover this post!",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((willDelete) => {
                if (willDelete) {
                    swal("Your post has been deleted successfully", {
                        icon: "success",
                    }).then((value) => {
                        location.href = self.attr('href');
                    });
                }
            });
    });
</script>